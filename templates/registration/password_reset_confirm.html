<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Set New Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .toggle-password-button {
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        padding-right: 0.75rem;
        color: #64748b; /* slate-500 */
        cursor: pointer;
      }
      .toggle-password-button:hover {
        color: #1e293b; /* slate-800 */
      }
    </style>
  </head>
  <body class="bg-slate-50 flex items-center justify-center min-h-screen p-4">
    <main class="w-full max-w-md mx-auto">
      <div class="bg-white p-8 sm:p-10 rounded-2xl shadow-lg">
        <div class="text-center">
          <svg
            class="mx-auto h-12 w-auto text-[#736b8e]"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"
            />
          </svg>
          <h2 class="mt-6 text-2xl font-bold text-slate-800">
            Set a New Password
          </h2>
        </div>

        {% if validlink %}
        <p class="text-center text-slate-500 mt-2 text-sm">
          Create a new, strong password for your account.
        </p>
        <form method="post" class="mt-8 space-y-6">
          {% csrf_token %} {% if form.non_field_errors %}
          <div
            class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md"
            role="alert"
          >
            {% for error in form.non_field_errors %}
            <p class="text-sm">{{ error }}</p>
            {% endfor %}
          </div>
          {% endif %} {% for field in form %}
          <div>
            <label
              for="{{ field.id_for_label }}"
              class="block text-sm font-medium text-slate-700"
              >{{ field.label }}</label
            >
            <div class="mt-1 relative">
              {{ field }} {% if field.field.widget.input_type == 'password' %}
              <div class="toggle-password-button">
                <svg
                  class="h-5 w-5 eye-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                  />
                </svg>
                <svg
                  class="h-5 w-5 eye-slash-icon hidden"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.243 4.243L6.228 6.228"
                  />
                </svg>
              </div>
              {% endif %}
            </div>
            {% for error in field.errors %}
            <div class="text-red-600 text-sm mt-1">
              <p>{{ error }}</p>
            </div>
            {% endfor %}
          </div>
          {% endfor %}

          <button
            type="submit"
            class="w-full flex justify-center bg-[#736b8e] text-white py-3 px-4 font-semibold rounded-lg hover:bg-[#5f5778] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#736b8e] transition-all duration-300 ease-in-out"
          >
            Change My Password
          </button>
        </form>
        {% else %}
        <div class="text-center mt-6">
          <p class="text-slate-600">
            This password reset link is invalid or has already been used.
          </p>
          <a
            href="{% url 'password_reset' %}"
            class="mt-4 inline-block w-full sm:w-auto bg-[#736b8e] text-white py-3 px-6 font-semibold rounded-lg hover:bg-[#5f5778] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#736b8e] transition-all duration-300 ease-in-out"
          >
            Request a New Link
          </a>
        </div>
        {% endif %}
      </div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const formFields = document.querySelectorAll(
          'form input[type="password"]'
        );
        const fieldClasses =
          "w-full px-4 py-3 border border-slate-300 rounded-lg shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-[#736b8e] focus:border-transparent transition-all duration-300";

        formFields.forEach(function (field) {
          field.className += field.className
            ? " " + fieldClasses
            : fieldClasses;
        });

        const toggleButtons = document.querySelectorAll(
          ".toggle-password-button"
        );
        toggleButtons.forEach(function (button) {
          button.addEventListener("click", function () {
            const input = this.previousElementSibling;
            const eyeIcon = this.querySelector(".eye-icon");
            const eyeSlashIcon = this.querySelector(".eye-slash-icon");

            if (input.type === "password") {
              input.type = "text";
              eyeIcon.classList.add("hidden");
              eyeSlashIcon.classList.remove("hidden");
            } else {
              input.type = "password";
              eyeIcon.classList.remove("hidden");
              eyeSlashIcon.classList.add("hidden");
            }
          });
        });
      });
    </script>
  </body>
</html>
