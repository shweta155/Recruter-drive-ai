<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title|default:"Login" }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .fade-out {
        transition: opacity 0.5s ease-out;
        opacity: 0;
      }
    </style>
  </head>
  <body class="bg-slate-50 flex items-center justify-center min-h-screen">
    <main class="w-full max-w-md mx-auto p-4 sm:p-6">
      <div class="bg-white p-8 sm:p-10 rounded-2xl shadow-lg">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-slate-800">Welcome Back!</h1>
          <p class="text-slate-500 mt-2">
            Sign in to continue to your account.
          </p>
        </div>

        <form method="post" class="space-y-6">
          {% csrf_token %} {% if form.non_field_errors %}
          <div
            class="bg-red-50 border border-red-200 text-sm text-red-600 rounded-lg p-3 text-center error-message-js"
          >
            {% for error in form.non_field_errors %}
            <span>{{ error }}</span>
            {% endfor %}
          </div>
          {% endif %}

          <div>
            <label
              for="{{ form.username.id_for_label }}"
              class="block text-sm font-medium text-slate-700 mb-2"
            >
              {{ form.username.label }}
            </label>
            <input
              type="email"
              name="{{ form.username.name }}"
              id="{{ form.username.id_for_label }}"
              class="w-full px-4 py-3 bg-slate-50 border rounded-lg placeholder-slate-400 focus:outline-none focus:ring-2 focus:border-transparent transition-shadow {% if form.username.errors %} border-red-500 ring-1 ring-red-500 {% else %} border-slate-300 focus:ring-[#736b8e] {% endif %}"
              placeholder="Enter your email address"
              required
            />
            {% if form.username.errors %}
            <div class="text-red-600 text-xs mt-1 error-message-js">
              {% for error in form.username.errors %}
              <p>{{ error }}</p>
              {% endfor %}
            </div>
            {% endif %}
            <div class="text-xs text-slate-500 mt-1">
              Use the email address you registered with.
            </div>
          </div>

          <div>
            <div class="flex justify-between items-center mb-2">
              <label
                for="{{ form.password.id_for_label }}"
                class="block text-sm font-medium text-slate-700"
              >
                {{ form.password.label }}
              </label>
              <a
                href="{% url 'password_reset' %}"
                class="text-sm font-medium text-[#736b8e] hover:text-[#5f5778]"
              >
                Forgot password?
              </a>
            </div>
            <div class="relative">
              <input
                type="password"
                name="{{ form.password.name }}"
                id="{{ form.password.id_for_label }}"
                class="w-full pl-4 pr-12 py-3 bg-slate-50 border rounded-lg ..."
                placeholder="••••••••"
                required
                minlength="8"
              />
              <button
                type="button"
                id="togglePasswordVisibility"
                class="absolute inset-y-0 right-0 flex items-center pr-4"
                aria-label="Toggle password visibility"
              >
                <svg
                  id="eyeIcon"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="w-5 h-5 text-slate-500"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.432 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                </svg>
                <svg
                  id="eyeSlashedIcon"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="w-5 h-5 text-slate-500 hidden"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243L6.228 6.228"
                  />
                </svg>
              </button>
            </div>

            {% if form.password.errors %}
            <div class="text-red-600 text-xs mt-1 error-message-js">
              {% for error in form.password.errors %}
              <p>{{ error }}</p>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <div>
            <button
              type="submit"
              class="w-full bg-[#736b8e] text-white py-3 font-semibold rounded-lg hover:bg-[#5f5778] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#736b8e] transition-all duration-300 ease-in-out shadow-md hover:shadow-lg"
            >
              Log In
            </button>
          </div>
        </form>
      </div>
    </main>

    <script>
      // Password visibility toggle (existing script)
      const toggleButton = document.getElementById("togglePasswordVisibility");
      const passwordInput = document.getElementById(
        "{{ form.password.id_for_label }}"
      );
      const eyeIcon = document.getElementById("eyeIcon");
      const eyeSlashedIcon = document.getElementById("eyeSlashedIcon");

      toggleButton.addEventListener("click", function () {
        const type =
          passwordInput.getAttribute("type") === "password"
            ? "text"
            : "password";
        passwordInput.setAttribute("type", type);
        eyeIcon.classList.toggle("hidden");
        eyeSlashedIcon.classList.toggle("hidden");
      });

      // New script for auto-hiding errors
      document.addEventListener("DOMContentLoaded", function () {
        const errorMessages = document.querySelectorAll(".error-message-js");
        if (errorMessages.length > 0) {
          setTimeout(() => {
            errorMessages.forEach((el) => {
              el.classList.add("fade-out");
              // After the transition ends, hide the element completely
              el.addEventListener("transitionend", () =>
                el.classList.add("hidden")
              );
            });
          }, 5000); // 5 seconds
        }
      });
    </script>
  </body>
</html>
